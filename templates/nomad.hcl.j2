# {{ ansible_managed }}.
#
# See https://www.nomadproject.io/docs/configuration

log_level = "{{ nomad_log_level }}"

datacenter = "{{ nomad_data_center }}"

data_dir = "/opt/nomad"

advertise {
  http  = "{{ ansible_default_ipv4.address }}:{{ nomad_port_http }}"
  rpc   = "{{ ansible_default_ipv4.address }}:{{ nomad_port_rpc }}"
}

{% if nomad_agent_type == 'server' %}
server {
  enabled = true
  bootstrap_expect = {{ nomad_bootstrap_expect }}
  # encrypt = "{{ nomad_encrypt }}"

  # server_join {
  #   retry_join = {{ nomad_retry_join_server | to_json }}
  # }
}
{% else %}
client {
  enabled = true

  server_join {
    retry_join = {{ nomad_retry_join | to_json }}
  }
}
{% endif %}

# plugin "docker" {
#   config {
#     {% if nomad_client_docker_auth_path %}
#     auth {
#       config = "{{ nomad_client_docker_auth_path }}"
#     }
#     {% endif %}
#
#     {% if nomad_client_docker_allowed_caps %}
#     allow_caps = {{ nomad_client_docker_allowed_caps | to_json }}
#     {% endif %}
#   }
# }
